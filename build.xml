<?xml version="1.0" encoding="UTF-8"?>
<project name="ciexperiment">
  <path id="path">
    <pathelement path="build"/>
    <fileset dir="lib">
      <include name="*.jar"/>
    </fileset>
  </path>
  
  <taskdef name="testng" classpath="lib/testng-5.11-jdk15.jar"
           classname="org.testng.TestNGAntTask" />
  
  <target name="init">
    <mkdir dir="build"/>
  </target>
  
  <target name="clean">
    <delete>
      <fileset dir="build" />
      <fileset dir="urn.uk.org.onegch.netkernel.ciexperiment">
        <include name="**/*.class"/>
      </fileset>
      <fileset dir="urn.test.uk.org.onegch.netkernel.ciexperiment">
        <include name="**/*.class"/>
      </fileset>
    </delete>
  </target>
  
  <target name="build" depends="init">
    <javac classpathref="path" srcdir="testNG-nk4" destdir="build"/>
    <javac classpathref="path" srcdir="urn.uk.org.onegch.netkernel.ciexperiment" destdir="urn.uk.org.onegch.netkernel.ciexperiment"/>
    <javac classpathref="path" srcdir="urn.test.uk.org.onegch.netkernel.ciexperiment" destdir="urn.test.uk.org.onegch.netkernel.ciexperiment"/>
  </target>
  
  <target name="generate-tests" depends="init">
    <xslt in="urn.test.uk.org.onegch.netkernel.ciexperiment/etc/system/Tests.xml"
          out="testng.xml"
          style="testNG-nk4/uk/org/onegch/netkernel/testNG/generate-suite.xsl"/>
  </target>
  
  <target name="test" depends="build,generate-tests">
    <testng classpathref="path"
            haltonfailure="true"
            suiterunnerclass="uk.org.onegch.netkernel.testNG.NKTestNG">
      <xmlfileset file="testng.xml"/>
    </testng>
  </target>
</project>